<div class="qd-page qd-apply-page">
  <div class="qd-container">
    <div class="qd-header">
      <h1>ğŸ¨ ç”³è¯·æˆä¸ºåˆ›ä½œè€…</h1>
      <p class="subtitle">åŠ å…¥åˆ›ä½œè€…è®¡åˆ’ï¼Œå±•ç¤ºæ‚¨çš„ä½œå“å¹¶è·å¾—æ‰“èµ</p>
    </div>

    {{#if this.model.is_creator}}
      <div class="qd-card success-card">
        <div class="icon">âœ…</div>
        <h2>æ‚¨å·²ç»æ˜¯åˆ›ä½œè€…äº†ï¼</h2>
        <p>æ‚¨å¯ä»¥å‰å¾€åˆ›ä½œè€…ä¸­å¿ƒä¸Šä¼ ä½œå“</p>
        <LinkTo @route="qd-center-make" class="btn btn-primary">
          å‰å¾€åˆ›ä½œè€…ä¸­å¿ƒ
        </LinkTo>
      </div>
    {{else if this.model.has_pending_application}}
      <div class="qd-card pending-card">
        <div class="icon">â³</div>
        <h2>æ‚¨çš„ç”³è¯·æ­£åœ¨å®¡æ ¸ä¸­</h2>
        <p>ç”³è¯·æ—¶é—´ï¼š{{this.model.pending_application.submitted_at}}</p>
        <p class="description">è¯·è€å¿ƒç­‰å¾…ç®¡ç†å‘˜å®¡æ ¸ï¼Œå®¡æ ¸ç»“æœå°†é€šè¿‡ç³»ç»Ÿæ¶ˆæ¯é€šçŸ¥æ‚¨</p>
        
        <div class="application-details">
          <h3>ç”³è¯·ä¿¡æ¯</h3>
          <div class="detail-item">
            <label>åˆ›ä½œé¢†åŸŸï¼š</label>
            <p>{{this.model.pending_application.creative_field}}</p>
          </div>
          <div class="detail-item">
            <label>åˆ›ä½œç»å†ï¼š</label>
            <p>{{this.model.pending_application.creative_experience}}</p>
          </div>
        </div>
        
        <LinkTo @route="qd-center" class="btn btn-default">
          è¿”å›ä½œå“å¢™
        </LinkTo>
      </div>
    {{else}}
      <div class="qd-card">
        <div class="fee-info">
          <div class="fee-box">
            <span class="label">ç”³è¯·è´¹ç”¨ï¼š</span>
            <span class="amount">{{this.model.application_fee}} ç§¯åˆ†</span>
          </div>
          <div class="balance-box {{if this.model.can_afford 'sufficient' 'insufficient'}}">
            <span class="label">å½“å‰ç§¯åˆ†ï¼š</span>
            <span class="amount">{{this.model.user_points}} ç§¯åˆ†</span>
          </div>
        </div>

        {{#unless this.model.can_afford}}
          <div class="warning-box">
            âš ï¸ æ‚¨çš„ç§¯åˆ†ä¸è¶³ï¼Œè¯·å…ˆè·å–è¶³å¤Ÿçš„ç§¯åˆ†å†ç”³è¯·
          </div>
        {{/unless}}

        <form class="application-form">
          <div class="form-group">
            <label for="creative-field">
              ä¸ªäººåˆ›ä½œé¢†åŸŸ <span class="required">*</span>
              <span class="hint">(10-500å­—ç¬¦)</span>
            </label>
            <textarea
              id="creative-field"
              rows="3"
              placeholder="ä¾‹å¦‚ï¼šæ•°å­—ç»˜ç”»ã€3Då»ºæ¨¡ã€UIè®¾è®¡ã€æ’ç”»ç­‰"
              {{on "input" this.updateCreativeField}}
              value={{this.creativeField}}
              maxlength="500"
            ></textarea>
            <div class="char-count {{if (and (gte this.creativeField.length 10) (lte this.creativeField.length 500)) 'valid' 'invalid'}}">
              {{this.creativeField.length}}/500
            </div>
          </div>

          <div class="form-group">
            <label for="creative-experience">
              åˆ›ä½œç»å† <span class="required">*</span>
              <span class="hint">(20-2000å­—ç¬¦ï¼Œè¯¦ç»†ä»‹ç»æ‚¨çš„åˆ›ä½œç»éªŒå’Œæˆå°±)</span>
            </label>
            <textarea
              id="creative-experience"
              rows="6"
              placeholder="è¯·è¯¦ç»†æè¿°æ‚¨çš„åˆ›ä½œç»å†ã€ä½œå“é£æ ¼ã€è·å¾—çš„è£èª‰ç­‰..."
              {{on "input" this.updateCreativeExperience}}
              value={{this.creativeExperience}}
              maxlength="2000"
            ></textarea>
            <div class="char-count {{if (and (gte this.creativeExperience.length 20) (lte this.creativeExperience.length 2000)) 'valid' 'invalid'}}">
              {{this.creativeExperience.length}}/2000
            </div>
          </div>

          <div class="form-group">
            <label for="portfolio-images">
              ä¸Šä¼ ä»£è¡¨ä½œæˆ–è¯æ˜ <span class="required">*</span>
              <span class="hint">(è‡³å°‘2å¼ ï¼Œæœ€å¤š5å¼ )</span>
            </label>
            
            <div class="image-upload-section">
              {{#if this.hasImages}}
                <div class="uploaded-images-grid">
                  {{#each this.uploadedImageUrls as |imageUrl index|}}
                    <div class="uploaded-image-item">
                      <img src={{imageUrl}} alt="ä½œå“{{index}}" />
                      <button 
                        class="btn-remove-img" 
                        {{on "click" (fn this.removeImage index)}}
                        type="button"
                      >
                        <i class="fa fa-times"></i>
                      </button>
                    </div>
                  {{/each}}
                </div>
              {{/if}}
              
              {{#if this.canUploadMore}}
                <label class="upload-btn-wrapper" for="portfolio-upload">
                  {{#if this.uploadingImage}}
                    <i class="fa fa-spinner fa-spin"></i>
                    <span>ä¸Šä¼ ä¸­...</span>
                  {{else}}
                    <i class="fa fa-cloud-upload-alt"></i>
                    <span>{{if this.hasImages "ç»§ç»­ä¸Šä¼ å›¾ç‰‡" "ç‚¹å‡»ä¸Šä¼ å›¾ç‰‡"}}</span>
                  {{/if}}
                </label>
                <input 
                  id="portfolio-upload"
                  type="file"
                  accept="image/jpeg,image/jpg,image/png,image/gif"
                  multiple
                  {{on "change" this.handleImageUpload}}
                  style="display:none;"
                />
              {{else}}
                <div class="upload-limit-reached">
                  <i class="fa fa-check-circle"></i>
                  å·²è¾¾åˆ°æœ€å¤§ä¸Šä¼ æ•°é‡ï¼ˆ5å¼ ï¼‰
                </div>
              {{/if}}
              
              <div class="upload-hint {{if this.hasEnoughImages 'valid' 'invalid'}}">
                <i class="fa fa-{{if this.hasEnoughImages 'check-circle' 'info-circle'}}"></i>
                å·²ä¸Šä¼  {{this.imageCount}}/5 å¼ å›¾ç‰‡
                {{#unless this.hasEnoughImages}}
                  ï¼ˆè‡³å°‘éœ€è¦2å¼ ï¼‰
                {{/unless}}
              </div>
              
              <div class="upload-hint">
                <i class="fa fa-info-circle"></i>
                æ”¯æŒ JPGã€PNGã€GIF æ ¼å¼ï¼Œå•ä¸ªæ–‡ä»¶ä¸è¶…è¿‡ 5MB
              </div>
            </div>
          </div>

          <div class="form-actions">
            <button
              type="button"
              class="btn btn-primary submit-btn {{unless this.canSubmit 'disabled'}}"
              {{on "click" this.submitApplication}}
              disabled={{unless this.canSubmit "disabled"}}
            >
              {{#if this.isSubmitting}}
                æäº¤ä¸­...
              {{else}}
                æäº¤ç”³è¯· (æ¶ˆè€— {{this.model.application_fee}} ç§¯åˆ†)
              {{/if}}
            </button>
            
            <LinkTo @route="qd-center" class="btn btn-default">
              è¿”å›ä½œå“å¢™
            </LinkTo>
          </div>
        </form>
      </div>
    {{/if}}
  </div>
</div>

{{! æˆåŠŸå¼¹çª— }}
{{#if this.showSuccess}}
  <div class="qd-modal-backdrop" {{on "click" this.hideSuccess}}>
    <div class="qd-modal success-modal" {{on "click" this.stopPropagation}}>
      <div class="modal-icon">âœ…</div>
      <h2>{{this.successMessage}}</h2>
      <p>ç®¡ç†å‘˜å®¡æ ¸é€šè¿‡åï¼Œæ‚¨å°†æ”¶åˆ°ç³»ç»Ÿé€šçŸ¥</p>
      <button class="btn btn-primary" {{on "click" this.hideSuccess}}>
        ç¡®å®š
      </button>
    </div>
  </div>
{{/if}}
